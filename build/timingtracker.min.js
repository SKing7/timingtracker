/*
 * timingtracker v0.0.1 | JavaScript TimingTracker Library
 *
 * Copyright 2015 liuzhe.pt<@alibaba-inc.com> - All rights reserved.
 * Dual licensed under MIT and Beerware license 
 *
 * :: 2015-11-20 17:29
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(a,["util/history"],b)}})("common/timingtracker",function(a){(function z(){var a=window;if(typeof a.performance==="undefined"){a.performance={}}if(!a.performance.now){var b=Date.now?Date.now():+new Date;if(e.timing&&e.timing){b=e.timing.navigationStart;a.performance.now=function(){var a=Date.now?Date.now():+new Date;return a-b}}}})();var b=window.M;var c=b.TimeTracker;var d=window;var e=d.performance;var f;var g=function(){return e.now()};var h={url:"http://203.130.42.237/s.gif",aid:1,prefixMap:{rt:"rt_"},relatedIndexes:{ol:["rt"]}};function i(a){var b=new Image;b.style.cssText="width:1px;height:1px;visibility:hidden;";b.onload=function(){b.parentNode.removeChild(b)};b.src=h.url+"?"+a;return b}function j(){return!b.re.isPreRendering&&(b.env!=="production"||Math.random()>=.5)}function k(a){if(a){var b=["/service/poi/keywords","/service/valueadded/infosearch"];var c=["/navigation/search"];var d;for(d=0;d<c.length;d++){if(l().indexOf(c[d])===0){return false}}for(d=0;d<b.length;d++){if(a.indexOf(b[d])===0){return true}}}return false}function l(){var b=a.getState().data;return"/"+b.module+"/"+b.action+"/"}function m(){var a=c.fht;c.fht=-1;return a}function n(){var a=e.timing;var b=a.navigationStart;var c={};c.ns=b;if(a.redirectStart){c.rds=a.redirectStart;c.rde=a.redirectEnd}c.fs=a.fetchStart;c.dls=a.domainLookupStart;c.dle=a.domainLookupEnd;c.cs=a.connectStart;c.ce=a.connectEnd;c.rqs=a.requestStart;c.rss=a.responseStart;c.rse=a.responseEnd;c.ds=a.domLoading;c.di=a.domInteractive;c.dcs=a.domContentLoadedEventStart;c.dce=a.domContentLoadedEventEnd;c.de=a.domComplete;c.ls=a.loadEventStart;if(a.loadEventEnd){c.le=a.loadEventEnd}for(var d in c){if(c.hasOwnProperty(d)){f.push("ol",d,c[d]-b)}}}function o(){var a=d.XMLHttpRequest;try{d.XMLHttpRequest=function(){var b=new a;var d=b.open;var e;var f={};try{b.open=function(a,h){if(k(h)){e=g();f[0]=e;b.addEventListener("readystatechange",function(){f[b.readyState]=g()});b.addEventListener("loadend",function(){c({type:a,url:h,readyStateTimes:f})})}return d.apply(b,arguments)}}catch(h){b.open=d}return b}}catch(b){d.XMLHttpRequest=a}function c(a){e(a);f.flush("ax")}function e(a){var b=f.push.bind(f);var c=a.readyStateTimes;var d=a.url;var e=c[0];var g={1:"open",2:"received",3:"loading",4:"done"};for(var h in g){if(g.hasOwnProperty(h)&&g[h]){b("ax",g[h],Math.round(c[h]-e));e=c[h]}}b("ax","url",d.substring(0,d.indexOf("?")||d))}}function p(){b.util.pgLoadHandler.push(a);function a(){var a=f.push.bind(f);if(c.fpt>=0){a("ol","la",c.ld-c.fpt);a("ol","dl",c.dcl-c.fpt)}g();c.fpt=c.dcl=c.ld=-1;d.setTimeout(function(){if(e.timing){n()}f.flush();f.setOnLoadStatus(true)},50)}function g(){var a=d.M.TS.t_ol;for(var b in a){if(a.hasOwnProperty(b)){f.push("ol",b,a[b])}}}}var q={};var r={};var s=j();function t(){this.isMonitorStarted=false;this.isOnLoadFired=false}var u=t.prototype;u.getPid=l;u.now=g;u.setOnLoadStatus=function(a){this.isOnLoadFired=a};u.monitor=function(){if(!s||this.isMonitorStarted){return}o();p();this.isMonitorStarted=true};u.flush=function(a){if(!s){q[a]=null;return}var b=i(x(a));document.body.appendChild(b)};u.push=function(a,b,c){var d=h.prefixMap;var e=d[a]||"";q[a]=q[a]||{};q[a][e+b]=encodeURIComponent(c)};u.add=function(a,b){this.push("rt",a,b)};u.start=function(a){var b=v(a);r[b]=w()};u.end=function(a){var b=v(a);var c=r[b];if(!c){c=m()}if(!c||c<0){return}this.push("rt",b,w()-c);if(this.isOnLoadFired||!this.isMonitorStarted){this.flush("rt")}r[b]=null};function v(a){return a}function w(){return(new Date).getTime()}function x(a){a=a||"ol";var b=h.relatedIndexes;var c="";var d=b[a];if(d){for(var e=0;e<d.length;e++){c+=y(q[d[e]]);q[d[e]]=null}}c+=y(q[a]);c+="tp="+a;c+="&aid="+h.aid;c+="&pid="+encodeURIComponent(l());if(navigator.connection&&navigator.connection.type!==void 0){c+="&ct="+navigator.connection.type}q[a]=null;return c}function y(a){var b="";if(a){for(var c in a){if(a.hasOwnProperty(c)){b+=c+"="+a[c]+"&"}}}return b}f=new t;return f});